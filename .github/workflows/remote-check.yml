name: Global OS Auto-Install Test

on: [push]

jobs:
  run-gui-check:
    strategy:
      fail-fast: false 
      matrix:
        os: [
          windows-latest, windows-2019, 
          ubuntu-latest, ubuntu-22.04, ubuntu-20.04,
          macos-15,      
          macos-14,      
          macos-13,      
          macos-12       
        ]
    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout Code
        uses: [actions/checkout@v4](https://github.com)

      - name: Set up Python 3.12
        uses: [actions/setup-python@v5](https://github.com)
        with:
          python-version: '3.12'

      - name: Install System Dependencies (Linux Only)
        if: startsWith(matrix.os, 'ubuntu')
        run: |
          sudo apt-get update
          sudo apt-get install -y libegl1 libgles2 libxkbcommon-x11-0 libdbus-1-3 \
            libxcb-cursor0 libxcb-xinerama0 libxcb-icccm4 libxcb-image0 \
            libxcb-keysyms1 libxcb-randr0 libxcb-render-util0 libxcb-xkb1

      - name: Install timeout on macOS
        if: startsWith(matrix.os, 'macos')
        run: brew install coreutils

      - name: Run MYOblue_GUI.py (Testing Auto-Install)
        shell: bash
        run: |
          TIMEOUT_CMD=$(command -v timeout || command -v gtimeout)
          
          if [ -n "$TIMEOUT_CMD" ]; then
            $TIMEOUT_CMD 300 python MYOblue_GUI.py || [ $? -eq 124 ] || echo "Finished"
          else
            python MYOblue_GUI.py & PID=$!
            sleep 300
            kill $PID 2>/dev/null || echo "App closed"
          fi
        env:
          QT_QPA_PLATFORM: offscreen
          MPLBACKEND: Agg
          PYTHONUNBUFFERED: 1
